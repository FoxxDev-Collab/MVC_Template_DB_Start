@{
    ViewData["Title"] = "Home";
    var firstName = ViewData["FirstName"]?.ToString();
    var lastName = ViewData["LastName"]?.ToString();
    var userName = ViewData["UserName"]?.ToString();
    var isAuthenticated = User.Identity?.IsAuthenticated == true;

    var displayName = !string.IsNullOrEmpty(firstName) && !string.IsNullOrEmpty(lastName)
        ? $"{firstName} {lastName}"
        : !string.IsNullOrEmpty(firstName)
            ? firstName
            : !string.IsNullOrEmpty(userName)
                ? userName
                : "Guest";
}

<div class="container-fluid py-5">
    <!-- Hero Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="text-center mb-4">
                @if (isAuthenticated)
                {
                    <div class="d-flex justify-content-center mb-3">
                        @{
                            ViewData["Initials"] = string.IsNullOrEmpty(firstName) && string.IsNullOrEmpty(lastName)
                                ? "U"
                                : $"{firstName?.FirstOrDefault() ?? ' '}{lastName?.FirstOrDefault() ?? ' '}".Trim();
                            ViewData["Size"] = "xl";
                            ViewData["Status"] = "online";
                        }
                        <partial name="_Avatar" />
                    </div>
                    <h1 class="display-4 mb-3">Welcome back, @displayName!</h1>
                    <p class="lead text-muted-foreground">Here's what's happening with your compliance tracking today.</p>
                }
                else
                {
                    <h1 class="display-3 mb-3">Welcome to Compliance Tracker</h1>
                    <p class="lead text-muted mb-4">Your comprehensive solution for managing compliance and tracking requirements.</p>
                    <div class="d-flex gap-3 justify-content-center">
                        <a href="/Account/Login" class="btn btn-primary btn-lg">Get Started</a>
                        <a href="/Components/Demo" class="btn btn-outline-primary btn-lg">View Demo</a>
                    </div>
                }
            </div>
        </div>
    </div>

    @if (isAuthenticated)
    {
        <!-- Quick Stats -->
        <div class="row g-4 mb-5">
            <div class="col-md-3 col-sm-6">
                @{
                    ViewData["Title"] = "Total Users";
                    ViewData["Body"] = "<div class='text-center py-3'><h2 class='mb-2'>24</h2><p class='text-muted-foreground mb-0'>Active users</p></div>";
                    ViewData["Variant"] = "default";
                    ViewData["CssClass"] = "h-100";
                }
                <partial name="_Card" />
            </div>

            <div class="col-md-3 col-sm-6">
                @{
                    ViewData["Title"] = "Compliance Rate";
                    ViewData["Body"] = "<div class='text-center py-3'><h2 class='mb-2 text-success'>87%</h2><p class='text-muted-foreground mb-0'>On track</p></div>";
                    ViewData["Variant"] = "default";
                    ViewData["CssClass"] = "h-100";
                }
                <partial name="_Card" />
            </div>

            <div class="col-md-3 col-sm-6">
                @{
                    ViewData["Title"] = "Pending Tasks";
                    ViewData["Body"] = "<div class='text-center py-3'><h2 class='mb-2 text-warning'>12</h2><p class='text-muted-foreground mb-0'>Need attention</p></div>";
                    ViewData["Variant"] = "default";
                    ViewData["CssClass"] = "h-100";
                }
                <partial name="_Card" />
            </div>

            <div class="col-md-3 col-sm-6">
                @{
                    ViewData["Title"] = "Completed";
                    ViewData["Body"] = "<div class='text-center py-3'><h2 class='mb-2'>156</h2><p class='text-muted-foreground mb-0'>This month</p></div>";
                    ViewData["Variant"] = "default";
                    ViewData["CssClass"] = "h-100";
                }
                <partial name="_Card" />
            </div>
        </div>

        <!-- Main Content -->
        <div class="row g-4">
            <!-- Recent Activity -->
            <div class="col-lg-8">
                @{
                    ViewData["Title"] = "Recent Activity";
                    ViewData["Body"] = @"
                        <div class='list-group list-group-flush'>
                            <div class='list-group-item d-flex align-items-center gap-3 border-0 px-0'>
                                <div class='avatar avatar-md bg-primary'>
                                    <span class='text-primary-foreground'>JD</span>
                                </div>
                                <div class='flex-grow-1'>
                                    <div class='d-flex justify-content-between align-items-start'>
                                        <div>
                                            <h6 class='mb-1'>John Doe updated compliance report</h6>
                                            <small class='text-muted-foreground'>2 hours ago</small>
                                        </div>
                                        <span class='badge bg-success rounded-pill'>Completed</span>
                                    </div>
                                </div>
                            </div>
                            <div class='list-group-item d-flex align-items-center gap-3 border-0 px-0'>
                                <div class='avatar avatar-md' style='background-color: var(--chart-2);'>
                                    <span style='color: white;'>SM</span>
                                </div>
                                <div class='flex-grow-1'>
                                    <div class='d-flex justify-content-between align-items-start'>
                                        <div>
                                            <h6 class='mb-1'>Sarah Miller created new task</h6>
                                            <small class='text-muted-foreground'>5 hours ago</small>
                                        </div>
                                        <span class='badge bg-primary rounded-pill'>New</span>
                                    </div>
                                </div>
                            </div>
                            <div class='list-group-item d-flex align-items-center gap-3 border-0 px-0'>
                                <div class='avatar avatar-md' style='background-color: var(--chart-3);'>
                                    <span style='color: var(--foreground);'>RJ</span>
                                </div>
                                <div class='flex-grow-1'>
                                    <div class='d-flex justify-content-between align-items-start'>
                                        <div>
                                            <h6 class='mb-1'>Robert Johnson reviewed documents</h6>
                                            <small class='text-muted-foreground'>1 day ago</small>
                                        </div>
                                        <span class='badge bg-info rounded-pill'>In Review</span>
                                    </div>
                                </div>
                            </div>
                            <div class='list-group-item d-flex align-items-center gap-3 border-0 px-0'>
                                <div class='avatar avatar-md bg-destructive'>
                                    <span class='text-destructive-foreground'>EW</span>
                                </div>
                                <div class='flex-grow-1'>
                                    <div class='d-flex justify-content-between align-items-start'>
                                        <div>
                                            <h6 class='mb-1'>Emily Wilson flagged compliance issue</h6>
                                            <small class='text-muted-foreground'>2 days ago</small>
                                        </div>
                                        <span class='badge bg-danger rounded-pill'>Urgent</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                    ViewData["Variant"] = "default";
                }
                <partial name="_Card" />
            </div>

            <!-- Progress Overview -->
            <div class="col-lg-4">
                @{
                    ViewData["Title"] = "Compliance Progress";
                    ViewData["Body"] = @"
                        <div class='d-flex flex-column gap-4'>
                            <div class='text-center'>
                                <div class='radial-progress radial-progress-lg mb-3' style='margin: 0 auto;'>
                                    <svg width='112' height='112' viewBox='0 0 112 112'>
                                        <circle class='radial-progress-circle radial-progress-bg'
                                                cx='56' cy='56' r='48' stroke-width='8' />
                                        <circle class='radial-progress-circle radial-progress-bar progress-success'
                                                cx='56' cy='56' r='48' stroke-width='8'
                                                stroke-dasharray='301.59289474462014'
                                                stroke-dashoffset='39.207076316400616' />
                                    </svg>
                                    <div class='radial-progress-label'>87%</div>
                                </div>
                                <p class='text-muted-foreground mb-0'>Overall Compliance</p>
                            </div>
                            <div>
                                <div class='d-flex justify-content-between mb-2'>
                                    <span class='small'>Security Standards</span>
                                    <span class='small fw-bold'>95%</span>
                                </div>
                                <div class='progress mb-3'>
                                    <div class='progress-bar bg-success' style='width: 95%'></div>
                                </div>

                                <div class='d-flex justify-content-between mb-2'>
                                    <span class='small'>Data Protection</span>
                                    <span class='small fw-bold'>82%</span>
                                </div>
                                <div class='progress mb-3'>
                                    <div class='progress-bar bg-primary' style='width: 82%'></div>
                                </div>

                                <div class='d-flex justify-content-between mb-2'>
                                    <span class='small'>Policy Review</span>
                                    <span class='small fw-bold'>73%</span>
                                </div>
                                <div class='progress'>
                                    <div class='progress-bar bg-warning' style='width: 73%'></div>
                                </div>
                            </div>
                        </div>
                    ";
                    ViewData["Variant"] = "default";
                }
                <partial name="_Card" />
            </div>
        </div>

        <div class="my-5">
            @{
                ViewData["Text"] = "";
            }
            <partial name="_Divider" />
        </div>

        <!-- Quick Actions -->
        <div class="row g-4">
            <div class="col-12">
                <h3 class="mb-4">Quick Actions</h3>
            </div>

            <div class="col-md-3 col-sm-6">
                <a href="/UserManagement" class="text-decoration-none">
                    @{
                        ViewData["Body"] = "<div class='text-center py-4'><h5 class='mb-2'>Manage Users</h5><p class='text-muted-foreground mb-0'>Add or edit user accounts</p></div>";
                        ViewData["Variant"] = "default";
                        ViewData["CssClass"] = "h-100 text-center hover-shadow";
                    }
                    <partial name="_Card" />
                </a>
            </div>

            <div class="col-md-3 col-sm-6">
                <a href="#" class="text-decoration-none">
                    @{
                        ViewData["Body"] = "<div class='text-center py-4'><h5 class='mb-2'>View Reports</h5><p class='text-muted-foreground mb-0'>Access compliance reports</p></div>";
                        ViewData["Variant"] = "default";
                        ViewData["CssClass"] = "h-100 text-center hover-shadow";
                    }
                    <partial name="_Card" />
                </a>
            </div>

            <div class="col-md-3 col-sm-6">
                <a href="#" class="text-decoration-none">
                    @{
                        ViewData["Body"] = "<div class='text-center py-4'><h5 class='mb-2'>Tasks</h5><p class='text-muted-foreground mb-0'>Manage your tasks</p></div>";
                        ViewData["Variant"] = "default";
                        ViewData["CssClass"] = "h-100 text-center hover-shadow";
                    }
                    <partial name="_Card" />
                </a>
            </div>

            <div class="col-md-3 col-sm-6">
                <a href="/Components/Demo" class="text-decoration-none">
                    @{
                        ViewData["Body"] = "<div class='text-center py-4'><h5 class='mb-2'>UI Components</h5><p class='text-muted-foreground mb-0'>View component library</p></div>";
                        ViewData["Variant"] = "default";
                        ViewData["CssClass"] = "h-100 text-center hover-shadow";
                    }
                    <partial name="_Card" />
                </a>
            </div>
        </div>
    }
    else
    {
        <!-- Features for non-authenticated users -->
        <div class="my-4">
            @{
                ViewData["Text"] = "Features";
            }
            <partial name="_Divider" />
        </div>

        <div class="row g-4 my-4">
            <div class="col-md-4">
                @{
                    ViewData["Title"] = "Secure & Compliant";
                    ViewData["Body"] = "<p>Built with security best practices and compliance standards in mind. Track and manage your compliance requirements efficiently.</p>";
                    ViewData["Variant"] = "primary";
                }
                <partial name="_Card" />
            </div>

            <div class="col-md-4">
                @{
                    ViewData["Title"] = "Fast & Efficient";
                    ViewData["Body"] = "<p>Modern, responsive interface built with the latest technologies. Access your data quickly from any device, anywhere.</p>";
                    ViewData["Variant"] = "success";
                }
                <partial name="_Card" />
            </div>

            <div class="col-md-4">
                @{
                    ViewData["Title"] = "Team Collaboration";
                    ViewData["Body"] = "<p>Work together with your team. Assign tasks, track progress, and ensure everyone stays on the same page.</p>";
                    ViewData["Variant"] = "info";
                }
                <partial name="_Card" />
            </div>
        </div>
    }
</div>

<style>
    .hover-shadow:hover {
        box-shadow: var(--shadow-lg) !important;
        transform: translateY(-2px);
        transition: all 0.2s ease;
    }

    .list-group-item {
        transition: background-color 0.2s ease;
    }

    .list-group-item:hover {
        background-color: var(--accent);
    }
</style>
